---
plugins:
  - serverless-domain-manager

service:
  name: slack-apis

frameworkVersion: '>=1.0.0'

provider:
  name: aws
  runtime: ruby2.5
  region: ${opt:region, 'us-east-2'}
  memorySize: 256
  deploymentBucket:
    name: ${env:SERVERLESS_BUCKET_NAME}
  deploymentPrefix: serverless
  apiKeys:
    - default_key
  tracing:
    apiGateway: true

package:
  include:
    - lib/**
    - bin/**
    - vendor/**
  exclude:
    - scripts/**
    - secrets/**
    - infra/**
    - docker-compose.*

functions:
  ping:
    handler: lib/slack-api/health.ping
    description: Healthiness endpoint for APIs.
    timeout: 60
    environment:
      GEM_PATH: vendor/bundle
      USE_AWS: true
      APP_AWS_ACCESS_KEY_ID: ${file(./secrets/app_account_ak)}
      APP_AWS_SECRET_ACCESS_KEY: ${file(./secrets/app_account_sk)}
    events:
      - http: GET ping
        cors: true

custom:
  customDomain:
    domainName: ${env:DOMAIN_TLD}
    basePath: ${env:DOMAIN_PATH}
    createRoute53Record: true
    certificateName: ${env:DOMAIN_PATH}.${env:DOMAIN_TLD}
